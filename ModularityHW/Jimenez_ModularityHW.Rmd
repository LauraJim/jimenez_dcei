---
title: "Jimenez_ModularityHW"
author: "Laura Jiménez"
date: "March 2018"
output: html_document
#bibliography: ModularityHW_refs.bib
#csl: Science.csl
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = F)
```

<!---```{r check, echo=F}
library(checkpoint)
checkpoint("2018-02-12")
```-->

```{r Funmtime}
mtime <- function(files)
{
  lapply(Sys.glob(files),function(x) {X = file.info(x)$mtime})
}
```

## Abstract

# Introduction
Use first research question as main idea:
1) Can we see climate warming for ourselves by analysing these data?
An important aspect in climate change research is the study of change weather and climate extremes...
Here we analyze the spatial and temporal characteristics of change in annual mean temperature and precipitation across the United States along the period 1950-2010...
# Methods

## Data
-
```{r data, cache=T, cache.extra=list(mtime("USAAnnualTemp1950_2008.rds"),mtime("USAAnnualPcpn1950_2008.rds"))}
# provided == T, if data are stored in the same directory as the code
# provided == F, if the data will be downloaded from a website
provided <- T
files <- c("USAAnnualTemp1950_2008.rds","USAAnnualPcpn1950_2008.rds")
if(provided==T)
{
  temp <- readRDS(files[1])
  prec <- readRDS(files[2])
}
# both files should be data.frame objects
str(temp)
str(prec)
```

## Models and R functions?

```{r cleaning, cache=T}
# Function that gets rid of stations with less than a minimum number of observations and transform the data to a matrix
# 'dats' must be a data frame object with the following variables: state, name, lon, lat, data, year
# 'minY' is the minimum number of years that a station must contain to be included in the final dataset
# Output: a matrix with the cleaned data
cleanTP <- function(dats,minY)
{
  nyear <- length(unique(dats$year))
  # Filtering data by weather station name and removing NA's
  filter1 <- aggregate(data~name,dats,length,na.action = na.omit)
  # Removing the weather stations with less than "minY" years of data
  filter2 <- subset(filter1,filter1$data >= minY)$name
  # Select only the stations in filter2
  filter3 <- subset(dats,subset=dats$name%in%filter2,selec=c(lon,lat,data,year))
  mclean <- matrix(as.vector(filter3$data),nrow=nyear)
  lonlat <- cbind(filter3$lon,filter3$lat)
  return(list(mclean,lonlat))
}

# Now use the function for cleaning both the temperature and the precipitation datasets:
temp.cl <- cleanTP(temp,40)
temp.cl[[1]][1:8,1:8]
prec.cl <- cleanTP(prec,40)
prec.cl[[1]][1:8,1:8]
```

Figure X shows the locations if the n1 temperature and n2 precipitation stations used in this study. Remember that we got rid of the stations with less than 40 years of data.
```{r mapData}
# showing the temp and prec trends in each location (maps package)
library(maps)
# map of the USA with state divisions
map('state', fill = F)
# extract the unique coordinate pairs from filter3 to plot the stations
sts <- temp.cl[[2]][nrow(temp.cl[[1]])*(1:ncol(temp.cl[[1]])),]
# show location of stations
points(sts,pch=19,col="orange")
# now color the points according to the temp or prec measurements

```

# Results
Answer the research questions:
2) In what parts of the country are temperatures getting warmer? Are there any parts that actually got colder over 1905-2010?
3) Can we say, based on these data, that a change in precipitation has occurred over this period?

# Discussion

# References